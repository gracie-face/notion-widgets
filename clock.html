<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Grouped World Clock â€” Retro Split-Flap</title>
<style>
  :root{
    /* Palette E */
    --seed:#CAD23C;    /* pill bg */
    --grassy:#47510B;  /* text */
    --flap-bg:#2c3107; /* split-flap tile bg */
    --flap-fg:#e6f0a2; /* split-flap digit color */

    --pill-radius:60px;
    --shadow:0 6px 18px rgba(0,0,0,.16);
    --inner-pad:16px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; padding:20px;
    background:#f5f5f5; color:var(--grassy);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  }

  .wrap{
    display:flex; gap:20px; overflow-x:auto; padding:6px;
    scrollbar-width:thin; scrollbar-color:#bfc6a0 #ecefe0;
  }
  .wrap::-webkit-scrollbar{height:8px}
  .wrap::-webkit-scrollbar-track{background:#ecefe0;border-radius:10px}
  .wrap::-webkit-scrollbar-thumb{background:#bfc6a0;border-radius:10px}

  /* Pill */
  .pill{
    background:var(--seed);
    border-radius:var(--pill-radius);
    box-shadow:var(--shadow);
    color:var(--grassy);
    flex:0 0 auto;
    width:clamp(320px, 32vw, 520px);
    height:clamp(220px, 28vw, 300px);
    padding:var(--inner-pad);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
  }

  .tz{
    font-weight:900; letter-spacing:1px; font-size:clamp(11px,1.1vw,13px);
    margin-bottom:10px; text-transform:uppercase;
    opacity:.95;
  }

  /* Split-flap time row */
  .time{
    display:flex; gap:8px; align-items:stretch; justify-content:center;
    padding:4px 2px;
  }

  .tile{
    position:relative;
    width:clamp(62px, 8vw, 96px);
    height:clamp(68px, 9vw, 105px);
    background:var(--flap-bg);
    color:var(--flap-fg);
    border-radius:12px;
    display:flex; align-items:center; justify-content:center;
    font-family: "Roboto Mono", SFMono-Regular, Menlo, Consolas, monospace;
    font-weight:800; font-size:clamp(40px,5vw,64px);
    letter-spacing:1px;
    box-shadow: inset 0 -5px 0 rgba(0,0,0,.25), inset 0 6px 0 rgba(255,255,255,.06);
    overflow:hidden;
    /* split line */
  }
  .tile:before, .tile:after{
    content:""; position:absolute; left:0; right:0; height:1px; background:rgba(255,255,255,.12);
  }
  .tile:before{ top:50%; opacity:.25 }
  .tile:after{ top:calc(50% + 1px); opacity:.08 }

  .colon{
    width:clamp(26px,3.2vw,44px);
    background:var(--flap-fg); color:var(--flap-bg);
    border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    font-family: "Roboto Mono", SFMono-Regular, Menlo, Consolas, monospace;
    font-weight:800; font-size:clamp(26px,3.4vw,40px);
    box-shadow: inset 0 2px 0 rgba(255,255,255,.35);
  }

  /* Flip animation (minute change) */
  .tile.flip .front{
    animation: flipFront .6s ease-in forwards;
  }
  .tile.flip .back{
    animation: flipBack .6s ease-out forwards;
  }
  .face{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    backface-visibility:hidden;
  }
  .front{ transform:rotateX(0deg) }
  .back { transform:rotateX(-180deg) }

  @keyframes flipFront{
    0%{ transform:rotateX(0deg) }
    100%{ transform:rotateX(180deg) }
  }
  @keyframes flipBack{
    0%{ transform:rotateX(-180deg) }
    100%{ transform:rotateX(0deg) }
  }

  /* City list */
  .cities{
    margin-top:clamp(8px,1.2vw,14px);
    display:flex; flex-direction:column; gap:4px;
    text-align:center;
  }
  .cities div{
    text-transform:uppercase;
    font-weight:900;
    letter-spacing:.35px;
    font-size:clamp(11px,1.3vw,13px);
  }
</style>
</head>
<body>
  <div class="wrap" id="wrap">
    <!-- Pills will be injected here -->
  </div>

<script>
/* ======= CONFIG ======= */
const GROUPS = [
  {
    label: "PACIFIC TIME",
    tz: "America/Los_Angeles",
    cities: ["HOOD RIVER","BEND","MONTEREY","LOS ANGELES"]
  },
  {
    label: "EASTERN TIME",
    tz: "America/New_York",
    cities: ["BROOKLYN","WISCASSET","VASS"]
  },
  {
    label: "WEST AFRICA TIME",
    tz: "Africa/Lagos",
    cities: ["LAGOS"]
  }
];

/* ======= RENDER ======= */
const wrap = document.getElementById('wrap');

function createTile(initial="0"){
  const tile = document.createElement('div');
  tile.className = 'tile';
  tile.innerHTML = `
    <div class="face front">${initial}</div>
    <div class="face back">${initial}</div>
  `;
  return tile;
}
function createColon(){
  const c = document.createElement('div');
  c.className = 'colon';
  c.textContent = ':';
  return c;
}

function makePill(group){
  const pill = document.createElement('div');
  pill.className = 'pill';

  pill.innerHTML = `<div class="tz">${group.label}</div>`;
  const timeRow = document.createElement('div');
  timeRow.className = 'time';

  // HH:MM -> 4 tiles + colon
  const t1 = createTile('0');
  const t2 = createTile('0');
  const t3 = createTile('0');
  const t4 = createTile('0');
  timeRow.append(t1, t2, createColon(), t3, t4);

  const cities = document.createElement('div');
  cities.className = 'cities';
  group.cities.forEach(c => {
    const d = document.createElement('div');
    d.textContent = c;
    cities.appendChild(d);
  });

  pill.append(timeRow, cities);
  wrap.appendChild(pill);
  return { tiles:[t1,t2,t3,t4] };
}

const pills = GROUPS.map(makePill);

/* ======= TIME / FLIP ======= */
let prevStrs = [];

function formatHHMM(date, tz){
  // 12-hour with leading zeros, minutes only
  const parts = new Intl.DateTimeFormat(undefined, {
    hour:'2-digit', minute:'2-digit', hour12:true, timeZone:tz
  }).format(date).replace(/\s/g,''); // e.g., "09:42AM"
  // take only HH:MM (ignore AM/PM for display)
  return parts.slice(0,5);
}

function setDigits(tile, digit){
  tile.querySelector('.front').textContent = digit;
  tile.querySelector('.back').textContent = digit;
}

function flipTo(tile, nextDigit){
  const front = tile.querySelector('.front');
  const back  = tile.querySelector('.back');
  // Set back to nextDigit, keep front current until flip completes
  back.textContent = nextDigit;
  tile.classList.remove('flip'); // reset if still mid-animation
  // force reflow to restart animation
  void tile.offsetWidth;
  tile.classList.add('flip');
  // After animation, set both faces to nextDigit and clear flip
  setTimeout(() => {
    front.textContent = nextDigit;
    back.textContent  = nextDigit;
    tile.classList.remove('flip');
  }, 600);
}

function updateAll(){
  const now = new Date();
  GROUPS.forEach((g, i) => {
    const str = formatHHMM(now, g.tz); // "09:42"
    const digits = [str[0], str[1], str[3], str[4]];

    if(!prevStrs[i]){
      // first render (no animation)
      digits.forEach((d, idx) => setDigits(pills[i].tiles[idx], d));
      prevStrs[i] = digits.join('');
      return;
    }

    // compare to previous; flip tiles that changed
    const prev = prevStrs[i];
    const prevDigits = [prev[0],prev[1],prev[2],prev[3]];
    digits.forEach((d, idx) => {
      if(d !== prevDigits[idx]) flipTo(pills[i].tiles[idx], d);
    });
    prevStrs[i] = digits.join('');
  });
}

// Initial draw and then check every second.
// Flip will only occur when a digit actually changes (i.e., minute changes).
updateAll();
setInterval(updateAll, 1000);

// Resize observer to keep tiles nicely centered on very narrow columns in Notion
new ResizeObserver(() => {
  // nothing needed here right now; hook left for future fine-tuning
}).observe(wrap);
</script>
</body>
</html>
